<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProTask Suite | Advanced Todo App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --secondary: #64748b;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --bg-input: #f8fafc;
            
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);

            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            
            --font-sans: 'Inter', sans-serif;
            --font-mono: 'Fira Code', monospace;
        }

        [data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --primary: #6366f1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-sans); }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 2rem 1rem;
            transition: background-color 0.3s ease;
        }

        .app-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* --- Header & Stats --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .brand h1 { font-weight: 700; font-size: 1.5rem; letter-spacing: -0.025em; }
        .brand-icon { font-size: 1.75rem; background: linear-gradient(135deg, var(--primary), var(--info)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .theme-toggle {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: grid;
            place-items: center;
            font-size: 1.25rem;
            transition: all 0.2s;
        }
        .theme-toggle:hover { background: var(--border); transform: rotate(15deg); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); font-family: var(--font-mono); }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-top: 0.25rem; }

        /* --- Input Area --- */
        .input-group {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .input-row { display: flex; gap: 0.75rem; }
        
        input, select {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            background: var(--bg-input);
            color: var(--text-main);
            outline: none;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus { border-color: var(--primary); ring: 2px solid var(--primary); }

        .main-input { flex: 2; font-size: 1rem; }
        
        .btn-add {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-add:hover { background: var(--primary-hover); transform: translateY(-1px); }

        /* --- Filter Bar --- */
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 0.5rem;
        }
        
        .filter-group { display: flex; gap: 0.5rem; }
        
        .filter-btn {
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-muted);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .filter-btn.active { background: var(--bg-card); color: var(--primary); border-color: var(--border); box-shadow: var(--shadow-sm); }

        /* --- Task List --- */
        .task-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-item {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid transparent;
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .task-item:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .task-item.dragging { opacity: 0.5; border: 2px dashed var(--primary); }

        /* Priority Borders */
        .priority-critical { border-left-color: var(--danger); }
        .priority-high { border-left-color: var(--warning); }
        .priority-medium { border-left-color: var(--info); }
        .priority-low { border-left-color: var(--secondary); }

        .task-header {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .drag-handle { cursor: grab; color: var(--text-muted); opacity: 0.5; }
        .drag-handle:hover { opacity: 1; }

        .checkbox-custom {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .task-item.completed .checkbox-custom { background: var(--success); border-color: var(--success); }
        .task-item.completed .checkbox-custom::after { content: '‚úì'; color: white; font-size: 14px; font-weight: bold; }
        .task-item.completed .task-title { text-decoration: line-through; color: var(--text-muted); }

        .task-content { flex: 1; }
        .task-title { font-weight: 500; font-size: 1rem; margin-bottom: 0.25rem; color: var(--text-main); }
        
        .task-meta { display: flex; gap: 0.75rem; font-size: 0.75rem; color: var(--text-muted); align-items: center; }
        
        .badge { padding: 0.1rem 0.4rem; border-radius: 4px; font-weight: 600; font-size: 0.7rem; text-transform: uppercase; }
        .badge-date { background: var(--bg-input); display: flex; align-items: center; gap: 4px; }
        .badge-date.overdue { color: var(--danger); background: #fef2f2; }

        .task-actions { display: flex; gap: 0.5rem; }
        
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            color: var(--text-muted);
            transition: all 0.2s;
        }
        
        .icon-btn:hover { background: var(--bg-input); color: var(--text-main); }
        .btn-delete:hover { background: #fef2f2; color: var(--danger); }

        /* --- Timer Section --- */
        .task-footer {
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timer-display {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
            background: var(--bg-card);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        .timer-controls { display: flex; gap: 0.25rem; }
        
        .timer-btn {
            border: none;
            background: var(--bg-card);
            color: var(--text-main);
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            transition: all 0.1s;
        }
        
        .timer-btn:hover { border-color: var(--primary); color: var(--primary); }
        .timer-btn.active { background: var(--success); color: white; border-color: var(--success); }

        /* --- Toast Notifications --- */
        #toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--bg-card);
            color: var(--text-main);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- Empty State --- */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }

    </style>
</head>
<body>

    <div class="app-container">
        <header class="header">
            <div class="brand">
                <span class="brand-icon">‚ö°</span>
                <div>
                    <h1>ProTask Suite</h1>
                    <small style="color: var(--text-muted)">Advanced Productivity System</small>
                </div>
            </div>
            <button class="theme-toggle" id="themeBtn" title="Toggle Theme">üåô</button>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingTasks">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="globalTimer">00:00:00</div>
                <div class="stat-label">Total Focus Time</div>
            </div>
        </div>

        <div class="input-group">
            <div class="input-row">
                <input type="text" id="taskInput" class="main-input" placeholder="What needs to be done?">
                <button class="btn-add" id="addBtn">
                    <span>Add Task</span>
                    <span>‚Üµ</span>
                </button>
            </div>
            <div class="input-row">
                <select id="prioritySelect" style="flex: 1;">
                    <option value="low">Low Priority</option>
                    <option value="medium" selected>Medium Priority</option>
                    <option value="high">High Priority</option>
                    <option value="critical">Critical üî•</option>
                </select>
                <input type="datetime-local" id="dueDateInput" style="flex: 1;">
            </div>
        </div>

        <div class="controls-bar">
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="active">Active</button>
                <button class="filter-btn" data-filter="completed">Completed</button>
            </div>
            <div class="filter-group">
                <select id="sortSelect" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                    <option value="date-new">Newest First</option>
                    <option value="date-old">Oldest First</option>
                    <option value="priority">Priority</option>
                    <option value="time">Time Spent</option>
                </select>
            </div>
        </div>

        <ul class="task-list" id="taskList">
            </ul>
        
        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-icon">‚òï</div>
            <h3>All caught up!</h3>
            <p>Relax or add a new task to get started.</p>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        /**
         * Advanced Todo Application
         * Architecture: Class-based State Management
         */

        class Utils {
            static generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            static formatTime(seconds) {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            }

            static formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }

            static isOverdue(dateString) {
                if (!dateString) return false;
                return new Date(dateString) < new Date();
            }
        }

        class Task {
            constructor(text, priority, dueDate) {
                this.id = Utils.generateId();
                this.text = text;
                this.priority = priority; // low, medium, high, critical
                this.dueDate = dueDate;
                this.completed = false;
                this.createdAt = new Date().toISOString();
                this.timeSpent = 0; // in seconds
                this.timerRunning = false;
            }
        }

        class TodoApp {
            constructor() {
                this.tasks = JSON.parse(localStorage.getItem('advanced-todo-tasks')) || [];
                this.globalTime = parseInt(localStorage.getItem('advanced-todo-global-time')) || 0;
                this.timers = {}; // Store interval IDs
                this.filter = 'all';
                this.sortBy = 'date-new';
                this.dragSrcEl = null;

                // Cache DOM elements
                this.elements = {
                    input: document.getElementById('taskInput'),
                    priority: document.getElementById('prioritySelect'),
                    date: document.getElementById('dueDateInput'),
                    addBtn: document.getElementById('addBtn'),
                    list: document.getElementById('taskList'),
                    empty: document.getElementById('emptyState'),
                    themeBtn: document.getElementById('themeBtn'),
                    globalTimer: document.getElementById('globalTimer'),
                    stats: {
                        total: document.getElementById('totalTasks'),
                        pending: document.getElementById('pendingTasks')
                    },
                    filterBtns: document.querySelectorAll('.filter-btn'),
                    sortSelect: document.getElementById('sortSelect')
                };

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.render();
                this.loadTheme();
                this.startGlobalTimerLoop(); // Check for running timers
            }

            setupEventListeners() {
                // Add Task
                this.elements.addBtn.addEventListener('click', () => this.addTask());
                this.elements.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTask();
                });

                // Filters
                this.elements.filterBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.elements.filterBtns.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filter = e.target.dataset.filter;
                        this.render();
                    });
                });

                // Sorting
                this.elements.sortSelect.addEventListener('change', (e) => {
                    this.sortBy = e.target.value;
                    this.render();
                });

                // Theme
                this.elements.themeBtn.addEventListener('click', () => this.toggleTheme());
            }

            addTask() {
                const text = this.elements.input.value.trim();
                if (!text) {
                    this.showToast('Please enter a task title', 'error');
                    this.elements.input.focus();
                    return;
                }

                const task = new Task(
                    text,
                    this.elements.priority.value,
                    this.elements.date.value
                );

                this.tasks.unshift(task);
                this.save();
                this.render();
                this.showToast('Task added successfully', 'success');
                
                // Reset inputs
                this.elements.input.value = '';
                this.elements.priority.value = 'medium';
                this.elements.date.value = '';
            }

            deleteTask(id) {
                if (confirm('Are you sure you want to delete this task?')) {
                    this.stopTaskTimer(id); // Ensure timer stops
                    this.tasks = this.tasks.filter(t => t.id !== id);
                    this.save();
                    this.render();
                    this.showToast('Task deleted', 'neutral');
                }
            }

            toggleComplete(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    if (task.completed) this.stopTaskTimer(id); // Stop timer if completed
                    this.save();
                    this.render();
                }
            }

            // --- Timer Logic ---

            toggleTimer(id) {
                const task = this.tasks.find(t => t.id === id);
                if (!task) return;

                if (task.timerRunning) {
                    this.stopTaskTimer(id);
                } else {
                    this.startTaskTimer(id);
                }
                this.render(); // Re-render to show active state
            }

            startTaskTimer(id) {
                const task = this.tasks.find(t => t.id === id);
                if (!task || task.completed) return;

                task.timerRunning = true;
                this.save();
                
                // Set interval for this specific task
                if (!this.timers[id]) {
                    this.timers[id] = setInterval(() => {
                        task.timeSpent++;
                        this.globalTime++;
                        this.updateTimerDisplay(id);
                        this.updateGlobalTimer();
                        // Debounced save could be better, but simple save is safer
                        if (task.timeSpent % 5 === 0) this.save(); 
                    }, 1000);
                }
            }

            stopTaskTimer(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.timerRunning = false;
                    this.save();
                }
                if (this.timers[id]) {
                    clearInterval(this.timers[id]);
                    delete this.timers[id];
                }
            }

            resetTimer(id) {
                this.stopTaskTimer(id);
                const task = this.tasks.find(t => t.id === id);
                // Subtract task time from global? Let's decide NO, global is cumulative usage.
                // Or YES, if we want strict accounting. Let's do strict.
                if (task) {
                    this.globalTime = Math.max(0, this.globalTime - task.timeSpent);
                    task.timeSpent = 0;
                    this.save();
                    this.render();
                    this.updateGlobalTimer();
                }
            }

            startGlobalTimerLoop() {
                // Resume timers for tasks that were running when page closed
                this.tasks.forEach(task => {
                    if (task.timerRunning) {
                        this.startTaskTimer(task.id);
                    }
                });
                this.updateGlobalTimer();
            }

            updateTimerDisplay(id) {
                const el = document.getElementById(`timer-${id}`);
                const task = this.tasks.find(t => t.id === id);
                if (el && task) {
                    el.innerText = Utils.formatTime(task.timeSpent);
                }
            }

            updateGlobalTimer() {
                this.elements.globalTimer.innerText = Utils.formatTime(this.globalTime);
                localStorage.setItem('advanced-todo-global-time', this.globalTime);
            }

            // --- Rendering ---

            getFilteredAndSortedTasks() {
                let filtered = this.tasks;

                // Filter
                if (this.filter === 'active') filtered = filtered.filter(t => !t.completed);
                if (this.filter === 'completed') filtered = filtered.filter(t => t.completed);

                // Sort
                return filtered.sort((a, b) => {
                    if (this.sortBy === 'date-new') return new Date(b.createdAt) - new Date(a.createdAt);
                    if (this.sortBy === 'date-old') return new Date(a.createdAt) - new Date(b.createdAt);
                    if (this.sortBy === 'time') return b.timeSpent - a.timeSpent;
                    if (this.sortBy === 'priority') {
                        const map = { critical: 4, high: 3, medium: 2, low: 1 };
                        return map[b.priority] - map[a.priority];
                    }
                    return 0;
                });
            }

            render() {
                const tasksToRender = this.getFilteredAndSortedTasks();
                
                // Update Stats
                this.elements.stats.total.innerText = this.tasks.length;
                this.elements.stats.pending.innerText = this.tasks.filter(t => !t.completed).length;

                // Empty State
                if (tasksToRender.length === 0) {
                    this.elements.list.innerHTML = '';
                    this.elements.empty.style.display = 'block';
                    return;
                }

                this.elements.empty.style.display = 'none';
                this.elements.list.innerHTML = tasksToRender.map(task => this.createTaskHTML(task)).join('');

                // Re-attach Drag Events
                this.addDragEvents();
            }

            createTaskHTML(task) {
                const isOverdue = !task.completed && task.dueDate && Utils.isOverdue(task.dueDate);
                const overdueClass = isOverdue ? 'overdue' : '';
                const activeClass = task.timerRunning ? 'active' : '';

                return `
                    <li class="task-item priority-${task.priority} ${task.completed ? 'completed' : ''}" 
                        draggable="true" 
                        data-id="${task.id}">
                        
                        <div class="task-header">
                            <span class="drag-handle" title="Drag to reorder">‚ãÆ‚ãÆ</span>
                            <div class="checkbox-custom" onclick="app.toggleComplete('${task.id}')"></div>
                            
                            <div class="task-content">
                                <div class="task-title">${task.text}</div>
                                <div class="task-meta">
                                    <span class="badge" style="background: #e2e8f0;">${task.priority}</span>
                                    ${task.dueDate ? `
                                        <span class="badge badge-date ${overdueClass}">
                                            üìÖ ${Utils.formatDate(task.dueDate)}
                                            ${isOverdue ? '(Overdue)' : ''}
                                        </span>
                                    ` : ''}
                                </div>
                            </div>

                            <div class="task-actions">
                                <button class="icon-btn btn-delete" onclick="app.deleteTask('${task.id}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>

                        <div class="task-footer">
                            <div class="timer-display" id="timer-${task.id}">${Utils.formatTime(task.timeSpent)}</div>
                            <div class="timer-controls">
                                <button class="timer-btn ${!task.timerRunning ? '' : 'hidden'}" onclick="app.toggleTimer('${task.id}')" title="Play">‚ñ∂</button>
                                <button class="timer-btn ${activeClass} ${task.timerRunning ? '' : 'hidden'}" onclick="app.toggleTimer('${task.id}')" title="Pause">‚è∏</button>
                                <button class="timer-btn" onclick="app.resetTimer('${task.id}')" title="Reset">üîÑ</button>
                            </div>
                        </div>
                    </li>
                `;
            }

            // --- Drag & Drop ---
            addDragEvents() {
                const items = document.querySelectorAll('.task-item');
                items.forEach(item => {
                    item.addEventListener('dragstart', this.handleDragStart.bind(this));
                    item.addEventListener('dragover', this.handleDragOver.bind(this));
                    item.addEventListener('drop', this.handleDrop.bind(this));
                    item.addEventListener('dragend', this.handleDragEnd.bind(this));
                });
            }

            handleDragStart(e) {
                this.dragSrcEl = e.target;
                e.target.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }

            handleDragOver(e) {
                if (e.preventDefault) e.preventDefault();
                return false;
            }

            handleDrop(e) {
                e.stopPropagation();
                const target = e.target.closest('.task-item');
                if (this.dragSrcEl !== target && target) {
                    const srcId = this.dragSrcEl.getAttribute('data-id');
                    const targetId = target.getAttribute('data-id');
                    
                    // Reorder array
                    const srcIndex = this.tasks.findIndex(t => t.id === srcId);
                    const targetIndex = this.tasks.findIndex(t => t.id === targetId);
                    
                    const [movedTask] = this.tasks.splice(srcIndex, 1);
                    this.tasks.splice(targetIndex, 0, movedTask);
                    
                    this.save();
                    this.render();
                }
                return false;
            }

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            // --- System ---
            save() {
                localStorage.setItem('advanced-todo-tasks', JSON.stringify(this.tasks));
            }

            showToast(message, type = 'neutral') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = 'toast';
                
                let icon = '‚ÑπÔ∏è';
                if (type === 'success') icon = '‚úÖ';
                if (type === 'error') icon = '‚ö†Ô∏è';
                
                toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
                
                // Color coding
                if (type === 'success') toast.style.borderLeftColor = 'var(--success)';
                if (type === 'error') toast.style.borderLeftColor = 'var(--danger)';

                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            toggleTheme() {
                const html = document.documentElement;
                const current = html.getAttribute('data-theme');
                const next = current === 'light' ? 'dark' : 'light';
                html.setAttribute('data-theme', next);
                this.elements.themeBtn.innerText = next === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }

            loadTheme() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.toggleTheme();
                }
            }
        }

        // Initialize App
        const app = new TodoApp();
        
        // Expose app to global scope for HTML onclick handlers
        window.app = app;

    </script>
</body>
</html>